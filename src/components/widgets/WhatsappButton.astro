---
import Portal from './Portal.astro';
import logoAguaMineral from '../../assets/images/site/logo.webp';
import logoSaoGeraldo from '../../assets/images/site/logoCajuina.png';
import Image from '../common/Image.astro';
---

<Portal>
  <div id="whatsapp-widget" class="whatsapp-widget">
    <!-- Backdrop -->
    <div id="whatsapp-backdrop" class="whatsapp-backdrop"></div>

    <!-- Card Principal -->
    <div id="whatsapp-card" class="whatsapp-card">
      <div class="whatsapp-header">
        <svg class="whatsapp-header-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M26.576 5.363c-2.69-2.69-6.406-4.354-10.511-4.354-8.209 0-14.865 6.655-14.865 14.865 0 2.732 0.737 5.291 2.022 7.491l-0.038-0.070-2.109 7.702 7.879-2.067c2.051 1.139 4.498 1.809 7.102 1.809h0.006c8.209-0.003 14.862-6.659 14.862-14.868 0-4.103-1.662-7.817-4.349-10.507l0 0zM16.062 28.228h-0.005c-0 0-0.001 0-0.001 0-2.319 0-4.489-0.64-6.342-1.753l0.056 0.031-0.451-0.267-4.675 1.227 1.247-4.559-0.294-0.467c-1.185-1.862-1.889-4.131-1.889-6.565 0-6.822 5.531-12.353 12.353-12.353s12.353 5.531 12.353 12.353c0 6.822-5.53 12.353-12.353 12.353h-0zM22.838 18.977c-0.371-0.186-2.197-1.083-2.537-1.208-0.341-0.124-0.589-0.185-0.837 0.187-0.246 0.371-0.958 1.207-1.175 1.455-0.216 0.249-0.434 0.279-0.805 0.094-1.15-0.466-2.138-1.087-2.997-1.852l0.010 0.009c-0.799-0.74-1.484-1.587-2.037-2.521l-0.028-0.052c-0.216-0.371-0.023-0.572 0.162-0.757 0.167-0.166 0.372-0.434 0.557-0.65 0.146-0.179 0.271-0.384 0.366-0.604l0.006-0.017c0.043-0.087 0.068-0.188 0.068-0.296 0-0.131-0.037-0.253-0.101-0.357l0.002 0.003c-0.094-0.186-0.836-2.014-1.145-2.758-0.302-0.724-0.609-0.625-0.836-0.637-0.216-0.010-0.464-0.012-0.712-0.012-0.395 0.010-0.746 0.188-0.988 0.463l-0.001 0.002c-0.802 0.761-1.3 1.834-1.3 3.023 0 0.026 0 0.053 0.001 0.079l-0-0.004c0.131 1.467 0.681 2.784 1.527 3.857l-0.012-0.015c1.604 2.379 3.742 4.282 6.251 5.564l0.094 0.043c0.548 0.248 1.25 0.513 1.968 0.74l0.149 0.041c0.442 0.14 0.951 0.221 1.479 0.221 0.303 0 0.601-0.027 0.889-0.078l-0.031 0.004c1.069-0.223 1.956-0.868 2.497-1.749l0.009-0.017c0.165-0.366 0.261-0.793 0.261-1.242 0-0.185-0.016-0.366-0.047-0.542l0.003 0.019c-0.092-0.155-0.34-0.247-0.712-0.434z"
          ></path>
        </svg>
        <div class="whatsapp-header-text">
          <span id="whatsapp-title" class="whatsapp-header-title">Atendimento ao Cliente</span>
          <span id="whatsapp-subtitle" class="whatsapp-header-subtitle"
            >Selecione um setor para receber<br />atendimento</span
          >
        </div>
      </div>

      <div class="whatsapp-content">
        <span id="whatsapp-info" class="whatsapp-info-text"
          >Normalmente respondemos em alguns minutos</span
        >

        <a
          id="whatsapp-contact-1"
          href="https://wa.me/5588999999999"
          target="_blank"
          class="whatsapp-contact-card"
          data-card="1"
        >
          <Image
            class="whatsapp-contact-avatar"
            src={logoSaoGeraldo}
            alt="Cajuína São Geraldo Logo"
          />
          <span class="whatsapp-contact-info">
            <span id="whatsapp-contact-1-name" class="whatsapp-contact-name"
              >SAC Cajuína São Geraldo</span
            >
            <span id="whatsapp-contact-1-desc" class="whatsapp-contact-description"
              >Serviço de Atendimento ao Cliente</span
            >
          </span>
          <svg class="whatsapp-contact-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M26.576 5.363c-2.69-2.69-6.406-4.354-10.511-4.354-8.209 0-14.865 6.655-14.865 14.865 0 2.732 0.737 5.291 2.022 7.491l-0.038-0.070-2.109 7.702 7.879-2.067c2.051 1.139 4.498 1.809 7.102 1.809h0.006c8.209-0.003 14.862-6.659 14.862-14.868 0-4.103-1.662-7.817-4.349-10.507l0 0zM16.062 28.228h-0.005c-0 0-0.001 0-0.001 0-2.319 0-4.489-0.64-6.342-1.753l0.056 0.031-0.451-0.267-4.675 1.227 1.247-4.559-0.294-0.467c-1.185-1.862-1.889-4.131-1.889-6.565 0-6.822 5.531-12.353 12.353-12.353s12.353 5.531 12.353 12.353c0 6.822-5.53 12.353-12.353 12.353h-0zM22.838 18.977c-0.371-0.186-2.197-1.083-2.537-1.208-0.341-0.124-0.589-0.185-0.837 0.187-0.246 0.371-0.958 1.207-1.175 1.455-0.216 0.249-0.434 0.279-0.805 0.094-1.15-0.466-2.138-1.087-2.997-1.852l0.010 0.009c-0.799-0.74-1.484-1.587-2.037-2.521l-0.028-0.052c-0.216-0.371-0.023-0.572 0.162-0.757 0.167-0.166 0.372-0.434 0.557-0.65 0.146-0.179 0.271-0.384 0.366-0.604l0.006-0.017c0.043-0.087 0.068-0.188 0.068-0.296 0-0.131-0.037-0.253-0.101-0.357l0.002 0.003c-0.094-0.186-0.836-2.014-1.145-2.758-0.302-0.724-0.609-0.625-0.836-0.637-0.216-0.010-0.464-0.012-0.712-0.012-0.395 0.010-0.746 0.188-0.988 0.463l-0.001 0.002c-0.802 0.761-1.3 1.834-1.3 3.023 0 0.026 0 0.053 0.001 0.079l-0-0.004c0.131 1.467 0.681 2.784 1.527 3.857l-0.012-0.015c1.604 2.379 3.742 4.282 6.251 5.564l0.094 0.043c0.548 0.248 1.25 0.513 1.968 0.74l0.149 0.041c0.442 0.14 0.951 0.221 1.479 0.221 0.303 0 0.601-0.027 0.889-0.078l-0.031 0.004c1.069-0.223 1.956-0.868 2.497-1.749l0.009-0.017c0.165-0.366 0.261-0.793 0.261-1.242 0-0.185-0.016-0.366-0.047-0.542l0.003 0.019c-0.092-0.155-0.34-0.247-0.712-0.434z"
            ></path>
          </svg>
        </a>

        <a
          id="whatsapp-contact-2"
          href="https://wa.me/5588988888888"
          target="_blank"
          class="whatsapp-contact-card"
          data-card="2"
        >
          <Image
            class="whatsapp-contact-avatar"
            src={logoAguaMineral}
            loading="eager"
            alt="Água Mineral São Geraldo Logo"
          />
          <span class="whatsapp-contact-info">
            <span id="whatsapp-contact-2-name" class="whatsapp-contact-name">SAC Água Mineral</span>
            <span id="whatsapp-contact-2-desc" class="whatsapp-contact-description"
              >Serviço de Atendimento ao Cliente</span
            >
          </span>
          <svg class="whatsapp-contact-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M26.576 5.363c-2.69-2.69-6.406-4.354-10.511-4.354-8.209 0-14.865 6.655-14.865 14.865 0 2.732 0.737 5.291 2.022 7.491l-0.038-0.070-2.109 7.702 7.879-2.067c2.051 1.139 4.498 1.809 7.102 1.809h0.006c8.209-0.003 14.862-6.659 14.862-14.868 0-4.103-1.662-7.817-4.349-10.507l0 0zM16.062 28.228h-0.005c-0 0-0.001 0-0.001 0-2.319 0-4.489-0.64-6.342-1.753l0.056 0.031-0.451-0.267-4.675 1.227 1.247-4.559-0.294-0.467c-1.185-1.862-1.889-4.131-1.889-6.565 0-6.822 5.531-12.353 12.353-12.353s12.353 5.531 12.353 12.353c0 6.822-5.53 12.353-12.353 12.353h-0zM22.838 18.977c-0.371-0.186-2.197-1.083-2.537-1.208-0.341-0.124-0.589-0.185-0.837 0.187-0.246 0.371-0.958 1.207-1.175 1.455-0.216 0.249-0.434 0.279-0.805 0.094-1.15-0.466-2.138-1.087-2.997-1.852l0.010 0.009c-0.799-0.74-1.484-1.587-2.037-2.521l-0.028-0.052c-0.216-0.371-0.023-0.572 0.162-0.757 0.167-0.166 0.372-0.434 0.557-0.65 0.146-0.179 0.271-0.384 0.366-0.604l0.006-0.017c0.043-0.087 0.068-0.188 0.068-0.296 0-0.131-0.037-0.253-0.101-0.357l0.002 0.003c-0.094-0.186-0.836-2.014-1.145-2.758-0.302-0.724-0.609-0.625-0.836-0.637-0.216-0.010-0.464-0.012-0.712-0.012-0.395 0.010-0.746 0.188-0.988 0.463l-0.001 0.002c-0.802 0.761-1.3 1.834-1.3 3.023 0 0.026 0 0.053 0.001 0.079l-0-0.004c0.131 1.467 0.681 2.784 1.527 3.857l-0.012-0.015c1.604 2.379 3.742 4.282 6.251 5.564l0.094 0.043c0.548 0.248 1.25 0.513 1.968 0.74l0.149 0.041c0.442 0.14 0.951 0.221 1.479 0.221 0.303 0 0.601-0.027 0.889-0.078l-0.031 0.004c1.069-0.223 1.956-0.868 2.497-1.749l0.009-0.017c0.165-0.366 0.261-0.793 0.261-1.242 0-0.185-0.016-0.366-0.047-0.542l0.003 0.019c-0.092-0.155-0.34-0.247-0.712-0.434z"
            ></path>
          </svg>
        </a>
      </div>
    </div>

    <!-- Botão e Balão -->
    <div class="whatsapp-bottom-container">
      <div id="whatsapp-balloon" class="whatsapp-balloon">
        <span id="whatsapp-balloon-text">Podemos te ajudar?</span>
      </div>
      <button id="whatsapp-button" class="whatsapp-button" aria-label="Abrir chat do WhatsApp">
        <svg id="whatsapp-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M26.576 5.363c-2.69-2.69-6.406-4.354-10.511-4.354-8.209 0-14.865 6.655-14.865 14.865 0 2.732 0.737 5.291 2.022 7.491l-0.038-0.070-2.109 7.702 7.879-2.067c2.051 1.139 4.498 1.809 7.102 1.809h0.006c8.209-0.003 14.862-6.659 14.862-14.868 0-4.103-1.662-7.817-4.349-10.507l0 0zM16.062 28.228h-0.005c-0 0-0.001 0-0.001 0-2.319 0-4.489-0.64-6.342-1.753l0.056 0.031-0.451-0.267-4.675 1.227 1.247-4.559-0.294-0.467c-1.185-1.862-1.889-4.131-1.889-6.565 0-6.822 5.531-12.353 12.353-12.353s12.353 5.531 12.353 12.353c0 6.822-5.53 12.353-12.353 12.353h-0zM22.838 18.977c-0.371-0.186-2.197-1.083-2.537-1.208-0.341-0.124-0.589-0.185-0.837 0.187-0.246 0.371-0.958 1.207-1.175 1.455-0.216 0.249-0.434 0.279-0.805 0.094-1.15-0.466-2.138-1.087-2.997-1.852l0.010 0.009c-0.799-0.74-1.484-1.587-2.037-2.521l-0.028-0.052c-0.216-0.371-0.023-0.572 0.162-0.757 0.167-0.166 0.372-0.434 0.557-0.65 0.146-0.179 0.271-0.384 0.366-0.604l0.006-0.017c0.043-0.087 0.068-0.188 0.068-0.296 0-0.131-0.037-0.253-0.101-0.357l0.002 0.003c-0.094-0.186-0.836-2.014-1.145-2.758-0.302-0.724-0.609-0.625-0.836-0.637-0.216-0.010-0.464-0.012-0.712-0.012-0.395 0.010-0.746 0.188-0.988 0.463l-0.001 0.002c-0.802 0.761-1.3 1.834-1.3 3.023 0 0.026 0 0.053 0.001 0.079l-0-0.004c0.131 1.467 0.681 2.784 1.527 3.857l-0.012-0.015c1.604 2.379 3.742 4.282 6.251 5.564l0.094 0.043c0.548 0.248 1.25 0.513 1.968 0.74l0.149 0.041c0.442 0.14 0.951 0.221 1.479 0.221 0.303 0 0.601-0.027 0.889-0.078l-0.031 0.004c1.069-0.223 1.956-0.868 2.497-1.749l0.009-0.017c0.165-0.366 0.261-0.793 0.261-1.242 0-0.185-0.016-0.366-0.047-0.542l0.003 0.019c-0.092-0.155-0.34-0.247-0.712-0.434z"
          ></path>
        </svg>
        <span id="whatsapp-close-x" class="whatsapp-button-close">✕</span>
      </button>
    </div>
  </div>
</Portal>

<style>
  /* Container Principal */
  .whatsapp-widget {
    position: fixed;
    bottom: 0;
    right: 0;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    margin: 0 1rem;
    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
  }

  /* Backdrop - Página Inteira e Transparente */
  .whatsapp-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: transparent;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 200ms ease-out,
      visibility 200ms ease-out;
    z-index: 998;
    pointer-events: none;
  }

  .whatsapp-backdrop.active {
    opacity: 1;
    visibility: visible;
    pointer-events: all;
  }

  /* Card Principal */
  .whatsapp-card {
    border-radius: 0.5rem;
    max-width: 450px;
    width: 100%;
    background-color: white;
    transform: translateY(30px) scale(0.9);
    opacity: 0;
    visibility: hidden;
    display: none;
    transition:
      transform 600ms cubic-bezier(0.34, 1.56, 0.64, 1),
      opacity 600ms ease-out,
      visibility 600ms ease-out;
    transform-origin: bottom right;
    position: relative;
    z-index: -1;
  }

  .whatsapp-card.active {
    transform: translateY(0) scale(1);
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    display: block;
    z-index: 999;
  }

  /* Fechamento mais rápido */
  .whatsapp-card.closing {
    transition:
      transform 250ms ease-in,
      opacity 250ms ease-in,
      visibility 250ms ease-in;
    transform: translateY(30px) scale(0.9);
    opacity: 0;
    pointer-events: none;
    display: none;
    z-index: -1;
  }

  /* Header */
  .whatsapp-header {
    padding: 1.25rem;
    background-color: #15a861;
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 0.75rem;
    align-items: start;
    color: white;
    border-radius: 0.5rem 0.5rem 0 0;
    position: relative;
  }

  .whatsapp-header-icon {
    width: 3rem;
    height: 3rem;
    padding: 0.25rem;
  }

  .whatsapp-header-icon path {
    fill: white;
  }

  .whatsapp-header-text {
    display: flex;
    flex-direction: column;
  }

  .whatsapp-header-title {
    font-size: 1.25rem;
    font-weight: 500;
    line-height: 1.3;
  }

  .whatsapp-header-subtitle {
    font-size: 0.875rem;
    display: block;
    margin-top: 0.25rem;
    opacity: 0.95;
  }

  /* Content */
  .whatsapp-content {
    padding: 1.25rem;
    display: grid;
    gap: 1.25rem;
  }

  .whatsapp-info-text {
    font-size: 0.875rem;
    color: #4b5563;
  }

  /* Cards de Contato com Bounce Individual */
  .whatsapp-contact-card {
    background-color: #f3f4f6;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    gap: 1rem;
    border-left: 3px solid #15a861;
    border-radius: 0.5rem;
    text-decoration: none;
    transform: translateX(-20px) scale(0.8);
    opacity: 0;
    transition:
      background-color 300ms ease-out,
      box-shadow 300ms ease-out,
      transform 300ms cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  /* Animação bounce individual para cada card */
  .whatsapp-card.active .whatsapp-contact-card[data-card='1'] {
    animation: bounceIn 550ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    animation-delay: 200ms;
  }

  .whatsapp-card.active .whatsapp-contact-card[data-card='2'] {
    animation: bounceIn 550ms cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    animation-delay: 450ms;
  }

  @keyframes bounceIn {
    0% {
      transform: translateX(-20px) scale(0.8);
      opacity: 0;
    }
    50% {
      transform: translateX(5px) scale(1.02);
      opacity: 1;
    }
    100% {
      transform: translateX(0) scale(1);
      opacity: 1;
    }
  }

  .whatsapp-contact-card:hover {
    background-color: #e5e7eb;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
    transform: translateY(-3px) translateX(0) scale(1.02);
  }

  .whatsapp-contact-card:active {
    transform: translateY(-1px) translateX(0) scale(0.98);
  }

  .whatsapp-contact-avatar {
    width: 3.5rem !important;
    height: 3.5rem !important;
    border-radius: 50% !important;
    object-fit: contain !important;
    background-color: #fef3c7;
    padding: 0.5rem !important;
    flex-shrink: 0;
  }

  .whatsapp-contact-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .whatsapp-contact-name {
    color: rgba(0, 0, 0, 0.8);
    font-weight: 500;
    font-size: 0.95rem;
  }

  .whatsapp-contact-description {
    font-size: 0.875rem;
    color: #6b7280;
  }

  .whatsapp-contact-icon {
    width: 2rem !important;
    height: 2rem !important;
  }

  .whatsapp-contact-icon path {
    fill: #15a861 !important;
  }

  /* Container Inferior */
  .whatsapp-bottom-container {
    display: flex;
    align-items: center;
    margin: 0.75rem 0;
    position: relative;
    z-index: 999;
  }

  /* Balão - Sem animação, apenas display */
  .whatsapp-balloon {
    background-color: white;
    border: 1px solid #e5e7eb;
    padding: 0.875rem 1rem;
    border-radius: 0.875rem;
    min-width: 15rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    font-size: 0.95rem;
    display: block;
  }

  .whatsapp-balloon.hidden {
    display: none;
  }

  /* Botão Principal */
  .whatsapp-button {
    margin-left: 1rem;
    width: 3.5rem;
    height: 3.5rem;
    padding: 0.875rem;
    border-radius: 50%;
    background-color: #15a861;
    border: none;
    cursor: pointer;
    box-shadow: 0 6px 16px rgba(21, 168, 97, 0.4);
    transition:
      transform 300ms cubic-bezier(0.34, 1.56, 0.64, 1),
      box-shadow 300ms ease-out;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .whatsapp-button::before {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    border-radius: 50%;
    background-color: #15a861;
    opacity: 0.6;
    animation: pulseButton 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes pulseButton {
    0%,
    100% {
      transform: scale(1);
      opacity: 0.6;
    }
    50% {
      transform: scale(1.2);
      opacity: 0;
    }
  }

  .whatsapp-button:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(21, 168, 97, 0.5);
  }

  .whatsapp-button:active {
    transform: scale(0.95);
  }

  #whatsapp-icon {
    position: relative;
    z-index: 1;
    width: 100%;
    height: 100%;
    transition:
      opacity 200ms ease-out,
      transform 200ms ease-out;
  }

  #whatsapp-icon path {
    fill: white !important;
  }

  .whatsapp-button-close {
    position: absolute;
    z-index: 1;
    color: white;
    font-size: 1.5rem;
    font-weight: 300;
    opacity: 0;
    transform: rotate(-90deg) scale(0.8);
    transition:
      opacity 200ms ease-out,
      transform 200ms ease-out;
    pointer-events: none;
  }

  /* Quando o widget está aberto, troca ícone pelo X */
  .whatsapp-button.open #whatsapp-icon {
    opacity: 0;
    transform: rotate(90deg) scale(0.8);
  }

  .whatsapp-button.open .whatsapp-button-close {
    opacity: 1;
    transform: rotate(0deg) scale(1);
  }

  /* ========================================
     RESPONSIVE & MOBILE FRIENDLY
     ======================================== */

  /* Tablets e telas médias (768px - 1024px) */
  @media (max-width: 1024px) {
    .whatsapp-widget {
      margin: 0 0.75rem;
    }

    .whatsapp-card {
      max-width: 420px;
    }
  }

  /* Mobile grande (481px - 767px) */
  @media (max-width: 767px) {
    .whatsapp-widget {
      margin: 0 0.5rem;
    }

    .whatsapp-card {
      max-width: calc(100vw - 1rem);
    }

    .whatsapp-header {
      padding: 1rem;
    }

    .whatsapp-header-icon {
      width: 2.5rem;
      height: 2.5rem;
    }

    .whatsapp-header-title {
      font-size: 1.1rem;
    }

    .whatsapp-header-subtitle {
      font-size: 0.8rem;
    }

    .whatsapp-content {
      padding: 1rem;
      gap: 1rem;
    }

    .whatsapp-contact-card {
      padding: 0.65rem;
      gap: 0.75rem;
    }

    .whatsapp-contact-avatar {
      width: 3rem;
      height: 3rem;
      padding: 0.4rem;
    }

    .whatsapp-contact-name {
      font-size: 0.9rem;
    }

    .whatsapp-contact-description {
      font-size: 0.8rem;
    }

    .whatsapp-contact-icon {
      width: 1.75rem !important;
      height: 1.75rem !important;
    }

    .whatsapp-balloon {
      min-width: 12rem;
      font-size: 0.85rem;
      padding: 0.75rem 0.875rem;
    }
  }

  /* Mobile pequeno (até 480px) */
  @media (max-width: 480px) {
    .whatsapp-widget {
      margin: 0 0.5rem;
    }

    .whatsapp-card {
      max-width: calc(100vw - 1rem);
      border-radius: 0.75rem;
    }

    .whatsapp-header {
      padding: 0.875rem;
      gap: 0.5rem;
    }

    .whatsapp-header-icon {
      width: 2.25rem;
      height: 2.25rem;
    }

    .whatsapp-header-title {
      font-size: 1rem;
    }

    .whatsapp-header-subtitle {
      font-size: 0.75rem;
      line-height: 1.4;
    }

    .whatsapp-content {
      padding: 0.875rem;
      gap: 0.875rem;
    }

    .whatsapp-info-text {
      font-size: 0.8rem;
    }

    .whatsapp-contact-card {
      padding: 0.6rem;
      gap: 0.625rem;
      border-left-width: 2px;
    }

    .whatsapp-bottom-container {
      margin: 0.5rem 0;
    }

    .whatsapp-balloon {
      min-width: 10rem;
      font-size: 0.8rem;
      padding: 0.625rem 0.75rem;
      border-radius: 0.75rem;
    }

    .whatsapp-button {
      width: 3.25rem;
      height: 3.25rem;
      padding: 0.8rem;
      margin-left: 0.75rem;
    }

    .whatsapp-button::before {
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
    }

    .whatsapp-button-close {
      font-size: 1.35rem;
    }
  }

  /* Mobile extra pequeno (até 360px) */
  @media (max-width: 360px) {
    .whatsapp-widget {
      margin: 0 0.375rem;
    }

    .whatsapp-card {
      max-width: calc(100vw - 0.75rem);
    }

    .whatsapp-header {
      padding: 0.75rem;
    }

    .whatsapp-header-title {
      font-size: 0.95rem;
    }

    .whatsapp-header-subtitle {
      font-size: 0.7rem;
    }

    .whatsapp-contact-card {
      padding: 0.5rem;
      gap: 0.5rem;
    }

    .whatsapp-balloon {
      min-width: 9rem;
      font-size: 0.75rem;
    }

    .whatsapp-button {
      width: 3rem;
      height: 3rem;
      padding: 0.7rem;
    }
  }

  /* Landscape em mobile */
  @media (max-height: 600px) and (orientation: landscape) {
    .whatsapp-card {
      max-height: 85vh;
      overflow-y: auto;
    }

    .whatsapp-header {
      padding: 0.75rem 1rem;
    }

    .whatsapp-content {
      padding: 0.875rem 1rem;
    }

    .whatsapp-contact-card {
      padding: 0.5rem;
    }
  }

  /* Touch-friendly: aumenta área de toque em mobile */
  @media (pointer: coarse) {
    .whatsapp-contact-card {
      min-height: 3.5rem;
    }

    .whatsapp-button {
      min-width: 3.5rem;
      min-height: 3.5rem;
    }
  }

  /* Previne zoom em inputs em iOS */
  @supports (-webkit-touch-callout: none) {
    .whatsapp-balloon,
    .whatsapp-contact-name,
    .whatsapp-contact-description {
      font-size: max(16px, 0.95rem);
    }
  }
</style>

<script is:inline>
  const DEFAULT_CONFIG = {
    enabled: true, // Ativo por padrão - GTM pode desabilitar
    title: 'Atendimento ao Cliente',
    subtitle: 'Selecione um setor para receber<br />atendimento',
    infoText: 'Normalmente respondemos em alguns minutos',
    balloonText: 'Podemos te ajudar?',
    balloonDelay: 3000,
    balloonDuration: 10000,
    contact1: {
      name: 'SAC Cajuína São Geraldo',
      description: 'Serviço de Atendimento ao Cliente',
      phone: '558521809690',
      initialContactMessage: 'Olá, vim pelo site e gostaria de mais informações.',
    },
    contact2: {
      name: 'SAC Água Mineral',
      description: 'Serviço de Atendimento ao Cliente',
      phone: '5588925227344',
      initialContactMessage: 'Quero revender *Água São Geraldo*.',
    },
  };

  // Função para obter configuração do GTM ou usar padrão
  function getWhatsAppConfig() {
    const dataLayer = window.dataLayer || [];
    const gtmConfig = dataLayer.find((item) => item.whatsappWidget);
    return gtmConfig?.whatsappWidget || DEFAULT_CONFIG;
  }

  // Aguarda o GTM carregar ou usa configuração padrão após timeout
  function initWhatsAppWidget() {
    const widget = document.getElementById('whatsapp-widget');
    const config = getWhatsAppConfig();

    // Se desabilitado explicitamente pelo GTM, esconde
    if (!config.enabled && widget) {
      widget.style.display = 'none';
      return;
    }

    // Aplica configurações de texto
    const titleEl = document.getElementById('whatsapp-title');
    const subtitleEl = document.getElementById('whatsapp-subtitle');
    const infoEl = document.getElementById('whatsapp-info');
    const balloonTextEl = document.getElementById('whatsapp-balloon-text');

    if (titleEl) titleEl.textContent = config.title;
    if (subtitleEl) subtitleEl.innerHTML = config.subtitle;
    if (infoEl) infoEl.textContent = config.infoText;
    if (balloonTextEl) balloonTextEl.textContent = config.balloonText;

    // Aplica configurações dos contatos
    const contact1 = document.getElementById('whatsapp-contact-1');
    const contact1Name = document.getElementById('whatsapp-contact-1-name');
    const contact1Desc = document.getElementById('whatsapp-contact-1-desc');

    if (contact1 && config.contact1) {
      const phone1 = config.contact1.phone;
      const message1 = config.contact1.initialContactMessage
        ? `?text=${encodeURIComponent(config.contact1.initialContactMessage)}`
        : '';
      contact1.setAttribute('href', `https://wa.me/${phone1}${message1}`);
      if (contact1Name) contact1Name.textContent = config.contact1.name;
      if (contact1Desc) contact1Desc.textContent = config.contact1.description;
    }

    const contact2 = document.getElementById('whatsapp-contact-2');
    const contact2Name = document.getElementById('whatsapp-contact-2-name');
    const contact2Desc = document.getElementById('whatsapp-contact-2-desc');

    if (contact2 && config.contact2) {
      const phone2 = config.contact2.phone;
      const message2 = config.contact2.initialContactMessage
        ? `?text=${encodeURIComponent(config.contact2.initialContactMessage)}`
        : '';
      contact2.setAttribute('href', `https://wa.me/${phone2}${message2}`);
      if (contact2Name) contact2Name.textContent = config.contact2.name;
      if (contact2Desc) contact2Desc.textContent = config.contact2.description;
    }

    // Inicializa comportamento do widget
    const button = document.getElementById('whatsapp-button');
    const card = document.getElementById('whatsapp-card');
    const backdrop = document.getElementById('whatsapp-backdrop');
    const balloon = document.getElementById('whatsapp-balloon');

    let isOpen = false;

    function openWidget() {
      isOpen = true;
      card?.classList.remove('closing');
      card?.classList.add('active');
      backdrop?.classList.add('active');
      balloon?.classList.add('hidden');
      button?.classList.add('open');
    }

    function closeWidget() {
      isOpen = false;
      card?.classList.add('closing');
      backdrop?.classList.remove('active');
      button?.classList.remove('open');

      setTimeout(() => {
        card?.classList.remove('active');
        card?.classList.remove('closing');
        balloon?.classList.remove('hidden');
      }, 250);
    }

    button?.addEventListener('click', () => {
      if (isOpen) {
        closeWidget();
      } else {
        openWidget();
      }
    });

    backdrop?.addEventListener('click', closeWidget);

    // Mostrar balão após delay configurável
    setTimeout(() => {
      if (!isOpen) {
        balloon?.classList.remove('hidden');
      }
    }, config.balloonDelay || 3000);

    // Esconder balão após duração configurável
    setTimeout(
      () => {
        balloon?.classList.add('hidden');
      },
      (config.balloonDelay || 3000) + (config.balloonDuration || 10000),
    );
  }

  // Aguarda um pequeno delay para garantir que o GTM tenha tempo de fazer o push
  setTimeout(() => {
    initWhatsAppWidget();
  }, 200);

  // Também observa mudanças na dataLayer
  if (window.dataLayer) {
    const originalPush = window.dataLayer.push;
    window.dataLayer.push = function (...args) {
      const result = originalPush.apply(this, args);
      if (args[0]?.whatsappWidget) {
        setTimeout(() => initWhatsAppWidget(), 0);
      }
      return result;
    };
  }
</script>
