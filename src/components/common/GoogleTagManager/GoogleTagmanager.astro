---
export interface Props {
  id: string;
  domain?: string;
  container?: string;
}

const {
  id = 'GTM_MEASUREMENT_ID',
  domain = 'https://www.googletagmanager.com',
  container = 'gtm.js',
} = Astro.props;
---

<noscript>
  <iframe
    src={`${domain}/ns.html?id=${id}`}
    height="0"
    width="0"
    style="display:none;visibility:hidden"></iframe>
</noscript>

<script is:inline define:vars={{ id, domain, container }}>
  // Espera o navegador ficar idle
  function loadGTM() {
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      'gtm.start': new Date().getTime(),
      event: container,
    });

    const script = document.createElement('script');
    script.async = true;
    script.src = `${domain}/${container}?id=${id}`;
    document.head.appendChild(script);
  }

  if ('requestIdleCallback' in window) {
    requestIdleCallback(loadGTM, { timeout: 2000 });
  } else {
    setTimeout(loadGTM, 1000);
  }
</script>
